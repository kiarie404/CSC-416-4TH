<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>External Interrupt - Developer Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="setting_things_up.html"><strong aria-hidden="true">1.</strong> Setting Things Up</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="setting_up_the_compiler.html"><strong aria-hidden="true">1.1.</strong> Setting up the compiler</a></li><li class="chapter-item expanded "><a href="setting_up_LLD_linker.html"><strong aria-hidden="true">1.2.</strong> Setting up the linker</a></li><li class="chapter-item expanded "><a href="setting_up_qemu.html"><strong aria-hidden="true">1.3.</strong> Setting up the Riscv Virtual environment</a></li><li class="chapter-item expanded "><a href="setting_up_build_automation.html"><strong aria-hidden="true">1.4.</strong> Setting up the Build automation tool</a></li></ol></li><li class="chapter-item expanded "><a href="writing_a_bare_metal_rust_executable.html"><strong aria-hidden="true">2.</strong> writing a bare metal Rust executable</a></li><li class="chapter-item expanded "><a href="boot_design.html"><strong aria-hidden="true">3.</strong> boot_design</a></li><li class="chapter-item expanded "><a href="boot_designs.html"><strong aria-hidden="true">4.</strong> Boot Design</a></li><li class="chapter-item expanded "><a href="the_bootloader.html"><strong aria-hidden="true">5.</strong> The Bootloader</a></li><li class="chapter-item expanded "><a href="the_bootloader_2.html"><strong aria-hidden="true">6.</strong> The Bootloader_2</a></li><li class="chapter-item expanded "><a href="setting_up_comunications.html"><strong aria-hidden="true">7.</strong> Setting Up Communications</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="designs_and_layouts.html"><strong aria-hidden="true">7.1.</strong> Designs and layouts</a></li><li class="chapter-item expanded "><a href="general_theory_on_communication.html"><strong aria-hidden="true">7.2.</strong> General Theory on communication</a></li><li class="chapter-item expanded "><a href="the_uart_theory.html"><strong aria-hidden="true">7.3.</strong> The UART </a></li><li class="chapter-item expanded "><a href="more_about_the_UART.html"><strong aria-hidden="true">7.4.</strong> More About the UART</a></li><li class="chapter-item expanded "><a href="programming_the_UART.html"><strong aria-hidden="true">7.5.</strong> Programming_the_UART</a></li></ol></li><li class="chapter-item expanded "><a href="theory_on_paging.html"><strong aria-hidden="true">8.</strong> Theory on Paging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="segmentation.html"><strong aria-hidden="true">8.1.</strong> segmentation</a></li><li class="chapter-item expanded "><a href="paging.html"><strong aria-hidden="true">8.2.</strong> paging</a></li></ol></li><li class="chapter-item expanded "><a href="setting_up_memory_management.html"><strong aria-hidden="true">9.</strong> Setting Up Memory Management</a></li><li class="chapter-item expanded "><a href="memory_designs.html"><strong aria-hidden="true">10.</strong> Designs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="RAM_management.html"><strong aria-hidden="true">10.1.</strong> The RAM Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="abstracting_the_RAM.html"><strong aria-hidden="true">10.1.1.</strong> Abstracting the RAM</a></li><li class="chapter-item expanded "><a href="allocation_and_deallocation_RAM.html"><strong aria-hidden="true">10.1.2.</strong> Allocating RAM Memory</a></li><li class="chapter-item expanded "><a href="fine_grained_alloation.html"><strong aria-hidden="true">10.1.3.</strong> Byte-grained allocation</a></li><li class="chapter-item expanded "><a href="setting_up_memory_virtualization_and_access_management.html"><strong aria-hidden="true">10.1.4.</strong> Setting Up RAM Memory Virtualization and access_management</a></li><li class="chapter-item expanded "><a href="handling_the_Physical_MMU.html"><strong aria-hidden="true">10.1.5.</strong> Using the Physical MMU instead of Virtual MMU</a></li><li class="chapter-item expanded "><a href="actual_implementation.html"><strong aria-hidden="true">10.1.6.</strong> Actual_implementation</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="handling_interrupts_and_traps.html"><strong aria-hidden="true">11.</strong> Handling interrupts and Traps</a></li><li class="chapter-item expanded "><a href="handling_interrupts_and_traps_2.html"><strong aria-hidden="true">12.</strong> Handling interrupts and Traps 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="how_each_exceptions_were_handled.html"><strong aria-hidden="true">12.1.</strong> Exceptions</a></li><li class="chapter-item expanded "><a href="timer_interrupt.html"><strong aria-hidden="true">12.2.</strong> Timer_interrupt</a></li><li class="chapter-item expanded "><a href="external_interrupt.html" class="active"><strong aria-hidden="true">12.3.</strong> External Interrupt</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="uart_interrupt.html"><strong aria-hidden="true">12.3.1.</strong> UART Interrupt</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="handling_external_interrupts.html"><strong aria-hidden="true">13.</strong> Handling External Interrupts</a></li><li class="chapter-item expanded "><a href="setting_up_processes.html"><strong aria-hidden="true">14.</strong> Setting up Processes</a></li><li class="chapter-item expanded "><a href="processes.html"><strong aria-hidden="true">15.</strong> Processes Version 2</a></li><li class="chapter-item expanded "><a href="the_block_driver.html"><strong aria-hidden="true">16.</strong> The Block Driver</a></li><li class="chapter-item expanded "><a href="system_calls.html"><strong aria-hidden="true">17.</strong> system_calls</a></li><li class="chapter-item expanded "><a href="Filesystem.html"><strong aria-hidden="true">18.</strong> Filesystem</a></li><li class="chapter-item expanded "><a href="user_processes.html"><strong aria-hidden="true">19.</strong> User Processes</a></li><li class="chapter-item expanded "><a href="overall_design.html"><strong aria-hidden="true">20.</strong> Overall Design</a></li><li class="chapter-item expanded "><a href="definitions_and_theories.html"><strong aria-hidden="true">21.</strong> Definitions and Theories</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="theory_on_the_linker.html"><strong aria-hidden="true">21.1.</strong> The linker</a></li><li class="chapter-item expanded "><a href="theory_on_Qemu.html"><strong aria-hidden="true">21.2.</strong> Qemu</a></li><li class="chapter-item expanded "><a href="fragmentation_issues.html"><strong aria-hidden="true">21.3.</strong> fragmentation_issues</a></li><li class="chapter-item expanded "><a href="memory_tracking_mechanisms.html"><strong aria-hidden="true">21.4.</strong> Memory Tracking Mechanisms</a></li><li class="chapter-item expanded "><a href="theory_on_MMU_implementation_in_riscv.html"><strong aria-hidden="true">21.5.</strong> Theory on MMU implementation in Riscv</a></li><li class="chapter-item expanded "><a href="VirtIO.html"><strong aria-hidden="true">21.6.</strong> VirtIO</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">22.</strong> Miscellenious</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="errors.html"><strong aria-hidden="true">22.1.</strong> Error Numbers</a></li><li class="chapter-item expanded "><a href="measuring_software_performance.html"><strong aria-hidden="true">22.2.</strong> Measuring Performance of software</a></li><li class="chapter-item expanded "><a href="importing_variables_from_the_linker_script.html"><strong aria-hidden="true">22.3.</strong> Importing variables from the Linker script</a></li><li class="chapter-item expanded "><a href="GNU_assembly_macros.html"><strong aria-hidden="true">22.4.</strong> GNU assembly macros</a></li><li class="chapter-item expanded "><a href="the_singleton_design.html"><strong aria-hidden="true">22.5.</strong> The singleton Structure</a></li><li class="chapter-item expanded "><a href="multitasking.html"><strong aria-hidden="true">22.6.</strong> Multitasking</a></li><li class="chapter-item expanded "><a href="Bitmasking_and_bit_operations.html"><strong aria-hidden="true">22.7.</strong> Bitmasking_and_bit_operations</a></li><li class="chapter-item expanded "><a href="compressed_instructions.html"><strong aria-hidden="true">22.8.</strong> Compressed Instructions</a></li><li class="chapter-item expanded "><a href="the_ABI.html"><strong aria-hidden="true">22.9.</strong> The ABI</a></li><li class="chapter-item expanded "><a href="ELF_files.html"><strong aria-hidden="true">22.10.</strong> Elf Files</a></li><li class="chapter-item expanded "><a href="riscv_registers.html"><strong aria-hidden="true">22.11.</strong> Riscv_registers</a></li><li class="chapter-item expanded "><a href="virt.html"><strong aria-hidden="true">22.12.</strong> Virtual representation of riscv in Qemu</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pcie_express_devices.html"><strong aria-hidden="true">22.12.1.</strong> PCIe express devices</a></li><li class="chapter-item expanded "><a href="virtio_devices.html"><strong aria-hidden="true">22.12.2.</strong> VIRTIO devices</a></li></ol></li><li class="chapter-item expanded "><a href="global_allocator.html"><strong aria-hidden="true">22.13.</strong> Global Allocator</a></li><li class="chapter-item expanded "><a href="falling_to_fly.html"><strong aria-hidden="true">22.14.</strong> Falling_to_fly</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">23.</strong> AfterMath</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="buffer_overflow_attacks.html"><strong aria-hidden="true">23.1.</strong> buffer_overflow_attacks</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">23.2.</strong> fork_bomb</div></li></ol></li><li class="chapter-item expanded "><a href="web_assembly.html"><strong aria-hidden="true">24.</strong> Web Assembly</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="literature_review_papers.html"><strong aria-hidden="true">24.1.</strong> Literature review papers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="software_deployment.html"><strong aria-hidden="true">24.1.1.</strong> Software_deployment</a></li></ol></li><li class="chapter-item expanded "><a href="setting_up_wasm_runtime.html"><strong aria-hidden="true">24.2.</strong> Setting Up Wasm Runtime</a></li><li class="chapter-item expanded "><a href="webassembly_challenges.html"><strong aria-hidden="true">24.3.</strong> webassembly_challenges</a></li><li class="chapter-item expanded "><a href="the_wasm_book.html"><strong aria-hidden="true">24.4.</strong> The Book</a></li><li class="chapter-item expanded "><a href="wasm_runtimes_in_no_std_environments.html"><strong aria-hidden="true">24.5.</strong> Using A Wasm Runtime in a no-std environment</a></li></ol></li><li class="chapter-item expanded "><a href="RISCV_RUN.html"><strong aria-hidden="true">25.</strong> RISCV_RUN</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="reasons_for_RISCV.html"><strong aria-hidden="true">25.1.</strong> reasons_for_RISCV</a></li><li class="chapter-item expanded "><a href="priviledged_architecture.html"><strong aria-hidden="true">25.2.</strong> priviledged_architecture</a></li><li class="chapter-item expanded "><a href="error_handling_in_machine_mode.html"><strong aria-hidden="true">25.3.</strong> error_handling_in_machine_mode</a></li><li class="chapter-item expanded "><a href="seperating_user_mode_from_machine_mode.html"><strong aria-hidden="true">25.4.</strong> seperating_user_mode_from_machine_mode</a></li><li class="chapter-item expanded "><a href="Supervisor_mode_to_the_rescue.html"><strong aria-hidden="true">25.5.</strong> Supervisor_mode_to_the_rescue</a></li><li class="chapter-item expanded "><a href="learning_magic.html"><strong aria-hidden="true">25.6.</strong> Learning_magic</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="resources.html"><strong aria-hidden="true">25.6.1.</strong> resources</a></li><li class="chapter-item expanded "><a href="random_notes.html"><strong aria-hidden="true">25.6.2.</strong> random_notes</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="references.html"><strong aria-hidden="true">26.</strong> References</a></li><li class="chapter-item expanded "><a href="problem_statement.html"><strong aria-hidden="true">27.</strong> Problem_statement</a></li><li class="chapter-item expanded "><a href="implementations.html"><strong aria-hidden="true">28.</strong> Implementations</a></li><li class="chapter-item expanded "><a href="debugging_in_rust.html"><strong aria-hidden="true">29.</strong> Debugging in Rust</a></li><li class="chapter-item expanded "><a href="qemu_configurations.html"><strong aria-hidden="true">30.</strong> Qemu Configurations</a></li><li class="chapter-item expanded "><a href="link_scripts.html"><strong aria-hidden="true">31.</strong> Link Scripts</a></li><li class="chapter-item expanded "><a href="documentation.html"><strong aria-hidden="true">32.</strong> Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="mermaid.js.html"><strong aria-hidden="true">32.1.</strong> mermaid</a></li></ol></li><li class="chapter-item expanded "><a href="testing_guide.html"><strong aria-hidden="true">33.</strong> Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="no_std_testing.html"><strong aria-hidden="true">33.1.</strong> No-Std Testing</a></li><li class="chapter-item expanded "><a href="unit_tests.html"><strong aria-hidden="true">33.2.</strong> Unit Tests</a></li><li class="chapter-item expanded "><a href="integration_tests.html"><strong aria-hidden="true">33.3.</strong> Integration Tests</a></li></ol></li><li class="chapter-item expanded "><a href="Debugging.html"><strong aria-hidden="true">34.</strong> Debugging</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Developer Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="external_interrupts"><a class="header" href="#external_interrupts">external_interrupts</a></h1>
<p>References :</p>
<ul>
<li></li>
<li></li>
</ul>
<p>As earlier said, there are three kids of interrupts :</p>
<ol>
<li>Timer Interrupts</li>
<li>Software Interrupts</li>
<li>External Interrupts</li>
</ol>
<p>In this chapter, we talk about External Interrupts.</p>
<p>External Interrupts are interrupts that come from other physical circuits that are not part of the subject core. With the exemption of the timer circuit (CLINT) AND other CPU cores.<br />
The timer circuit is exempted because its interrupts already have a more dedicated name : Timer Interrupts<br />
The other CPU_core circuits are also exempted because their interrups also have a more dedicated name : Software Interrupts.</p>
<p>The UART circuit may send an interrupt to the CPU when its buffer is full. Now that's an external Interrupt.<br />
A sensor sending interrupts, A mouse... any external circuit that is not part of the core_processor circuitry.</p>
<p>THe CPU/Core receives interrupt signals through dedicated pins called CPU_interrupt_pins. </p>
<h2 id="the-past"><a class="header" href="#the-past">THe Past</a></h2>
<p>In the Past, each external circuit was connected a dedicated pin, as seen below
[undone]</p>
<p>But this meant that the CPU had to :</p>
<ol>
<li>Have many pins</li>
<li>Co-ordinate how the different interrupts were managed. </li>
</ol>
<p>Managing interrupts means doing a combinations of the two actions listed below:</p>
<ol>
<li>Choosing which interrupts the CPU will ignore.</li>
<li>Setting the order of priority by which the interrupts will be sorted (if in case different interrupts happen simultaneously)</li>
</ol>
<h2 id="the-present-time"><a class="header" href="#the-present-time">The Present Time</a></h2>
<p>The past method had some inconveniences.</p>
<ol>
<li>That method required the CPU to have many pins. That may be expensive in terms of space and cost.  What if you have 100 external circuits? Are you going to make the CPU have 100 pins? Meeeeh that's too much fam.</li>
<li>That method was too hardware-independent, it was inflexible. It was NOT modular. This point will become clearer when we compare it to the PLIC method in the next few lines. For now, take my word for it ha ha. Such fickle words.</li>
</ol>
<p>THe PLIC method. </p>
<p>PLIC stands for Platform Level Interrupt Controller. This is a dedicated circuit that is independent from the CPU. It is a circuit dedicated to receiving all external signals, managing those external signals and eventually supplying the CPU  with the sorted interrupts through a single dedicated pin.</p>
<p>The word &quot;Platform&quot; in this case means (CPU circuit + the outside world).<br />
For example, a platform can be a motherboard or </p>
<p>Here is a demo figure :
[undone]</p>
<h3 id="advantages-of-the-plic-method"><a class="header" href="#advantages-of-the-plic-method">Advantages of the PLIC method</a></h3>
<ol>
<li>Now the CPU does NOT have to have to have baggage circuitry for managing the externl interrupts. THe CPU becomes more lean. </li>
<li>You can swap out the PLIC circuit version/design without changing the CPU circuitry. This was the part where I was saying something about modularity. For Example, you may switch from a 20-pin PLIC to a 50-pin PLIC. Boom! you can now handle more external devices without changing the CPU circuitry.</li>
<li>The CPU only needs at least one pin to deal with many external interrupts.</li>
<li>You can have many versions of PLICs running on a single Motherboard. You may use a certain PLIC for certain conditions and another for other conditions. Who said only software needs to be modular? Who said hardware always has to be dedicated/fixed?</li>
</ol>
<p>The pin that connects the PLIC to the CPU is called the External Interrupt Pin (EI pin).<br />
You can disable this pin by setting the MEIE and SEIE bits in the MIE register.<br />
MEIE stands for Machine External Interrupt Enable<br />
SEIE stands for Supervisor External Interrupt Enable
<img src="images/RISCV/MIE%20register.png" alt="" /></p>
<p>Here is th interaction between the PLIC, the CPU and the CLINT
<img src="./images/plic_cpu_structure.png" alt="(PLIC and CLINT)interraction with CPU" /></p>
<p>Each PLIC implementation is unique in its own way, there is no standard PLIC design.<br />
From here on, the PLIC being described is specific to Qemu.</p>
<p>You can control the behavior of the PLIC through exposed registers.<br />
The PLIC has pins that are connected to the external circuits. According to <a href="https://github.com/qemu/qemu/blob/master/include/hw/riscv/virt.h">this Qemu source file</a>, the UART is connected to pin 10 of the PLIC. The VIRTIO devices are attached to  1 through 8, and the PCI express devices are 32 through 35.</p>
<h2 id="how-to-control-the-plic"><a class="header" href="#how-to-control-the-plic">How to Control the PLIC</a></h2>
<p>Full details of how the PLIC works and how you can control it can be found in <a href="https://github.com/qemu/qemu/blob/master/include/hw/riscv/virt.h">this Sifive Paper</a>. The PLIC described there is not the same as the PLIC used in Qemu, but the theory on what the different registers do is the same. The only difference is that the memory mapping implementation is different. That is 100% inconsequential to the functioning theory of the PLIC.</p>
<p>The functions of the PLIC remain the same :</p>
<ol>
<li>Receive interrupts from many external sources</li>
<li>Filter certain interrups by ignoring some of them and accepting others.</li>
<li>Sort the accepted interrupts by their order of priority and put them in a pending array</li>
<li>Allow the CPU to fetch the pending interrupts.</li>
</ol>
<p>The PLIC exposes regiters that help the programmer to execute and monitor the above functionalities.<br />
The register are :</p>
<ol>
<li>The Buffer Register - claim/complete register combined</li>
<li>The pending register</li>
<li>The threshold register</li>
<li>The Enable Register</li>
<li>The priority register</li>
</ol>
<p>We will cover the use of each register in the next section</p>
<h3 id="1-receiving-interrupts"><a class="header" href="#1-receiving-interrupts">1. Receiving Interrupts</a></h3>
<p>Each PLIC pin is connected to an external circuit. Each pin has a unique number or ID. For example pin 10, pin 20...<br />
The number of pins is equal to the number of external circuits that the PLIC can receive.</p>
<p>An interrupt ID is a fancy name for Pin Number. For example, the Interrupt ID for a UART[0] buffer read is 10.</p>
<p>You can choose to ignore some external circuits. Instead of physically detaching those circuits from the motherboard, you can disable the PLIC pins connected to those devices.<br />
To disable them, you have to modify the bitmap found in the Enable Register. The enable register contains an array of bits that corresponds to the Interrupt Ids. For example, to disable pin 10, I will write 0 to the 10th bit of the <strong>Enable Register</strong>.</p>
<h3 id="2-how-to-modify-priority-ordering"><a class="header" href="#2-how-to-modify-priority-ordering">2. How to modify Priority ordering</a></h3>
<p>One of the functions of the PLIC is to sort the pending interrupts by their level of urgency.</p>
<p>Each Interrupt ID has to be associated with a priority value.<br />
A priority value helps the PLIC organize the pending interrupts by their level of urgency. The more the priority value, the more the level of urgency.</p>
<p>Priority value ranges from 0-7. If the priority value of an interrupt is 0, the PLIC should ignore that interrupt and DECLINE putting that interrupt in the pending list. That interrupt does not deserve to even get sorted, it is acknowledged by the PLIC but it is never presented to the CPU.</p>
<p>If interrupts with the same priority occur simultaneously, the interrupt whose ID is lower is given more priority.</p>
<p>The <strong>priority register</strong> is an array of memory units. The number of this units corresponds to the number of each pin. So if I want to set the priority of the interrupt coming through pin 10 to have priority 2, I will write 2 in the priority_regiter[10] memory address</p>
<p>The <strong>Threshold register</strong> stores the lowest priority value that your PLIC will NOT tolerate. For example, if you want to ignore all interrupts with priority values that are less than 2, you will set the threshold to 1.<br />
As you might have guessed, the default value of the threshold is zero. You are free to change it. If you set it at 7, it means all interrupts will not get sorted by the PLIC... they will be ignored.</p>
<h3 id="3-fetching-the-interrupts-from-the-plic"><a class="header" href="#3-fetching-the-interrupts-from-the-plic">3. Fetching The Interrupts from the PLIC.</a></h3>
<p>After the PLIC sorts the Interrupts, it stores then in the <strong>Pending Register</strong>. The Pending Register is also an array of bits that mirror the PLIC pins. If a pin receives an interrupt signal, the corresponding bit in the pending register is chaged from 0 to 1.<br />
From this format, the ordering is sorted automatically, no fancy circuits get involved. </p>
<p>The CPU can then parse the Pending Register procedurally. If a bit is set to one, it calculates the offset to determine the interrupt ID implied.<br />
The PLIC automatically picks the highest priority Interrupt ID from the pending register and stores it in the Buffer Register. So you don't have to waste time parsing the pending register. The pending register can help you know how the number and type of interrupts that are pending.</p>
<p>To fetch the actual interrupt ID, you read from the <strong>Buffer Register</strong>. After you have read it and handled it, you have to notify the PLIC that that interrupt should no longer be considered pending. 
To notify the PLIC to remove the interrupt from the pending list, you write the same Interrupt ID back to the Buffer Register. If the PLIC detects that the ID being written by the CPU is the same as the one in the Buffer... it removes it from the buffer and uploads the next pending priority ID.</p>
<p>If you write the wrong Interrupt ID, nothing will happen. Bugs will haunt you. Boooo hoooo sooo terrifying.... ooooh I'm scared oooooh 😂. On a serious note, this will cause bugs, watch out.</p>
<p>Just do what you want, everything else is irrelevant.<br />
So what if you end up homeless? so what if you fail at things you don't care about? What is so awful about falling short of societal standards? So what if you end up poor?<br />
Life is pointless, it is depressing to not do what you want. It is depressing to do things out of fear or obligation.<br />
It is depressing to be 'responsible'.<br />
Just do what matters to you, what you think is important. everything else is a waste of time and useless.</p>
<p>Fun and curiosity first. Everything else is noise, including responsible actions.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="timer_interrupt.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="uart_interrupt.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="timer_interrupt.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="uart_interrupt.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>


    </body>
</html>
